"use strict";!function(){var e=ax5.ui,t=ax5.util;e.addClass({className:"calendar",version:"0.8.8"},function(){var a=function(){var a,n=this,l=1;this.instanceId=ax5.getGuid(),this.target=null,this.selection=[],this.selectionMap={},this.selectableMap={},this.markerMap={},this.printedDay={start:"",end:""},this.config={clickEventName:"click",theme:"default",mode:"day",dateFormat:"yyyy-MM-dd",displayDate:new Date,animateTime:250,dimensions:{controlHeight:"40",controlButtonWidth:"40",colHeadHeight:"30",itemPadding:2},lang:{yearHeading:"Choose the year",monthHeading:"Choose the month",yearTmpl:"%s",months:["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],dayTmpl:"%s"},multipleSelect:!1,selectMode:"day",defaultMarkerTheme:"holiday",defaultPeriodTheme:"period"},a=this.config;var i=function(e,t){e&&e.onStateChanged?e.onStateChanged.call(t,t):this.onStateChanged&&this.onStateChanged.call(t,t),t=null},r=function(){return'\n                <div class="ax5-ui-calendar {{theme}}" data-calendar-els="root" onselectstart="return false;">\n                    {{#control}}\n                    <div class="calendar-control" data-calendar-els="control" style="{{controlCSS}}">\n                        <a class="date-move-left" data-calendar-move="left" style="{{controlButtonCSS}}">{{{left}}}</a>\n                        <div class="date-display" data-calendar-els="control-display" style="{{controlCSS}}"></div>\n                        <a class="date-move-right" data-calendar-move="right" style="{{controlButtonCSS}}">{{{right}}}</a>\n                    </div>\n                    {{/control}}\n                    <div class="calendar-body" data-calendar-els="body"></div>\n                </div>\n                '},d=function(){var e=jQuery.extend(!0,{},a,{controlCSS:{},controlButtonCSS:{}}),n=r();e.controlButtonCSS.height=e.controlCSS.height=t.cssNumber(a.dimensions.controlHeight),e.controlButtonCSS["line-height"]=e.controlCSS["line-height"]=t.cssNumber(a.dimensions.controlHeight),e.controlButtonCSS.width=t.cssNumber(a.dimensions.controlHeight),e.controlCSS=t.css(e.controlCSS),e.controlButtonCSS=t.css(e.controlButtonCSS);try{return ax5.mustache.render(n,e)}finally{e=null,n=null}},s=function(){return'\n                <table data-calendar-table="day" cellpadding="0" cellspacing="0" style="width:100%;">\n                    <thead>\n                        <tr>\n                        {{#weekNames}}\n                            <td class="calendar-col-{{col}}" style="height: {{colHeadHeight}}">\n                            {{label}}\n                            </td>\n                        {{/weekNames}}\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            {{#list}}    \n                            {{#isStartOfWeek}}\n                            {{^@first}}\n                        </tr>\n                        <tr>\n                            {{/@first}}\n                            {{/isStartOfWeek}}\n                            <td class="calendar-col-{{col}}" style="{{itemStyles}}">\n                                <a class="calendar-item-day {{addClass}}" data-calendar-item-date="{{thisDate}}">\n                                    <span class="addon addon-header"></span>\n                                    {{thisDataLabel}}\n                                    <span class="addon addon-footer"></span>\n                                </a>\n                            </td>\n                            {{/list}}\n                        </tr>\n                    </tbody>\n                </table>\n                '},o=function(){return'\n                <table data-calendar-table="month" cellpadding="0" cellspacing="0" style="width:100%;">\n                    <thead>\n                        <tr>\n                            <td class="calendar-col-0" colspan="3" style="height: {{colHeadHeight}}">\n                            {{colHeadLabel}}\n                            </td>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            {{#list}}    \n                            {{#isStartOfRow}}\n                            {{^@first}}\n                        </tr>\n                        <tr>\n                            {{/@first}}\n                            {{/isStartOfRow}}\n                            <td class="calendar-col-{{col}}" style="{{itemStyles}}">\n                                <a class="calendar-item-month {{addClass}}" data-calendar-item-month="{{thisMonth}}">\n                                    <span class="addon"></span>\n                                    {{thisMonthLabel}}\n                                    <span class="lunar"></span>\n                                </a>\n                            </td>\n                            {{/list}}\n                        </tr>\n                    </tbody>\n                </table>\n                '},c=function(){return'\n                <table data-calendar-table="year" cellpadding="0" cellspacing="0" style="width:100%;">\n                    <thead>\n                        <tr>\n                            <td class="calendar-col-0" colspan="4" style="height: {{colHeadHeight}}">\n                            {{colHeadLabel}}\n                            </td>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            {{#list}}    \n                            {{#isStartOfRow}}\n                            {{^@first}}\n                        </tr>\n                        <tr>\n                            {{/@first}}\n                            {{/isStartOfRow}}\n                            <td class="calendar-col-{{col}}" style="{{itemStyles}}">\n                                <a class="calendar-item-year {{addClass}}" data-calendar-item-year="{{thisYear}}">\n                                    <span class="addon"></span>\n                                    {{thisYearLabel}}\n                                    <span class="lunar"></span>\n                                </a>\n                            </td>\n                            {{/list}}\n                        </tr>\n                    </tbody>\n                </table>\n                '},h=function(){var e,n,l=t.date(a.displayDate),i="",r="";return a.control&&("day"==a.mode||"d"==a.mode?(i=a.control.yearTmpl?a.control.yearTmpl.replace("%s",l.getFullYear()):l.getFullYear(),r=a.control.monthTmpl?a.control.monthTmpl.replace("%s",a.lang.months[l.getMonth()]):a.lang.months[l.getMonth()],this.$["control-display"].html(function(){return a.control.yearFirst?'<span data-calendar-display="year">'+i+'</span><span data-calendar-display="month">'+r+"</span>":'<span data-calendar-display="month">'+r+'</span><span data-calendar-display="year">'+i+"</span>"}())):"month"==a.mode||"m"==a.mode?(i=a.control.yearTmpl?a.control.yearTmpl.replace("%s",l.getFullYear()):l.getFullYear(),this.$["control-display"].html('<span data-calendar-display="year">'+i+"</span>")):("year"==a.mode||"y"==a.mode)&&(e=a.control.yearTmpl?a.control.yearTmpl.replace("%s",l.getFullYear()-10):l.getFullYear()-10,n=a.control.yearTmpl?a.control.yearTmpl.replace("%s",Number(l.getFullYear())+9):Number(l.getFullYear())+9,this.$["control-display"].html(e+" ~ "+n)),this.$["control-display"].find("[data-calendar-display]").on(a.clickEventName,function(e){var a,n=t.findParentNode(e.target,function(e){return e.getAttribute("data-calendar-display")?!0:void 0});n&&(a=n.getAttribute("data-calendar-display"),this.changeMode(a)),n=null,a=null}.bind(this))),l=null,i=null,r=null,e=null,n=null,this},u=function(e){var l,r,d,o,c=t.date(e),u=new Date(c.getFullYear(),c.getMonth(),1,12),m=a.displayDate,f=function(){var e=u.getDay();0==e&&(e=7);try{return t.date(u,{add:{d:-e}})}finally{e=null}}(),p=c.getMonth(),g={},b=this.$.body.width(),v=Math.floor(b*(6/7)),M=s();for(a.dimensions.height&&(v=t.number(a.dimensions.height)-t.number(a.dimensions.colHeadHeight)),g.height=Math.floor(v/6)-2*t.number(a.dimensions.itemPadding)+"px",g["line-height"]=g.height,g.padding=t.cssNumber(a.dimensions.itemPadding),o={weekNames:[].concat(ax5.info.weekNames),list:[]},o.weekNames.forEach(function(e){e.colHeadHeight=t.cssNumber(a.dimensions.colHeadHeight)}),l=f,r=0;6>r;){for(d=0;7>d;){var D=""+t.date(l,{"return":a.dateFormat}),S={row:r,col:d,isStartOfWeek:0==d,thisDate:""+D,thisDataLabel:a.lang.dayTmpl.replace("%s",l.getDate()),itemStyles:t.css(g),addClass:function(){return a.selectable?n.selectableMap[D]?l.getMonth()==p?"live":"":"disable":l.getMonth()==p?D==t.date(m,{"return":"yyyyMMdd"})?"focus":"live":""}()+" "+function(){return n.markerMap[D]?n.markerMap[D].theme||a.defaultMarkerTheme:""}()+" "+function(){return n.selectionMap[D]?"selected-day":""}()};o.list.push(S),d++,l=t.date(l,{add:{d:1}}),D=null,S=null}r++}this.$.body.html(ax5.mustache.render(M,o)),this.$.body.find("[data-calendar-item-date]").on(a.clickEventName,function(e){e=e||window.event,y.call(n,e,"date"),t.stopEvent(e)}),this.printedDay={start:f,end:l},i.call(this,null,{self:this,action:"printDay",printedDay:this.printedDay}),h.call(this),c=null,u=null,m=null,f=null,l=null,p=null,g=null,r=null,d=null,b=null,v=null,o=null,M=null},m=function(e){var l,r,d,s,c,u=t.date(e),m=u.getMonth(),f={},p=this.$.body.width(),g=Math.floor(p*(6/7)),b=o();for(a.dimensions.height&&(g=t.number(a.dimensions.height)-t.number(a.dimensions.colHeadHeight)),f.height=Math.floor(g/4)-2*t.number(a.dimensions.itemPadding)+"px",f["line-height"]=f.height,f.padding=t.cssNumber(a.dimensions.itemPadding),c={colHeadHeight:t.cssNumber(a.dimensions.colHeadHeight),colHeadLabel:a.lang.monthHeading,list:[]},s=0,d=0,l=0;4>l;){for(r=0;3>r;){var v={row:l,col:r,isStartOfRow:0==r,thisMonth:u.getFullYear()+"-"+t.setDigit(d+1,2)+"-"+t.setDigit(u.getDate(),2),thisMonthLabel:a.lang.months[d],itemStyles:t.css(f),addClass:function(){return a.selectable?n.selectableMap[d]?"live":"disable":"live"}()+" "+function(){return d==m?"focus":""}()+" "+function(){return n.markerMap[d]?n.markerMap[d].theme||a.defaultMarkerTheme:""}()};c.list.push(v),d++,r++,v=null}l++}this.$.body.html(ax5.mustache.render(b,c)),this.$.body.find("[data-calendar-item-month]").on(a.clickEventName,function(e){e=e||window.event,y.call(n,e,"month"),t.stopEvent(e)}),this.printedDay={start:u.getFullYear()+"-"+t.setDigit(s+1,2),end:u.getFullYear()+"-"+t.setDigit(d,2)},i.call(this,null,{self:this,action:"printMonth",printedDay:this.printedDay}),h.call(this),u=null,m=null,f=null,l=null,r=null,d=null,s=null,p=null,g=null,c=null,b=null},f=function(e){var l,r,d,s,o,u=t.date(e),m=u.getFullYear(),f={},p=this.$.body.width(),g=Math.floor(p*(6/7)),b=c();for(a.dimensions.height&&(g=t.number(a.dimensions.height)-t.number(a.dimensions.colHeadHeight)),f.height=Math.floor(g/5)-2*t.number(a.dimensions.itemPadding)+"px",f["line-height"]=f.height,f.padding=t.cssNumber(a.dimensions.itemPadding),o={colHeadHeight:t.cssNumber(a.dimensions.colHeadHeight),colHeadLabel:a.lang.yearHeading,list:[]},s=m-10,d=m-10,l=0;5>l;){for(r=0;4>r;){var v={row:l,col:r,isStartOfRow:0==r,thisYear:d+"-"+t.setDigit(u.getMonth()+1,2)+"-"+t.setDigit(u.getDate(),2),thisYearLabel:a.lang.yearTmpl.replace("%s",d),itemStyles:t.css(f),addClass:function(){return a.selectable?n.selectableMap[d]?"live":"disable":"live"}()+" "+function(){return d==m?"focus":""}()+" "+function(){return n.selectableMap[d]?n.selectableMap[d].theme||a.defaultMarkerTheme:""}()};o.list.push(v),d++,r++,v=null}l++}this.$.body.html(ax5.mustache.render(b,o)),this.$.body.find("[data-calendar-item-year]").on(a.clickEventName,function(e){e=e||window.event,y.call(this,e,"year"),t.stopEvent(e)}),this.printedDay={start:s,end:d-1},i.call(this,null,{self:this,action:"printYear",printedDay:this.printedDay}),h.call(this),u=null,m=null,f=null,l=null,r=null,d=null,s=null,p=null,g=null,o=null,b=null},y=function(e,i,r,d){var s,o,c;i=i||"date",r=t.findParentNode(e.target,function(e){return e.getAttribute("data-calendar-item-"+i)?!0:void 0}),r&&(d=r.getAttribute("data-calendar-item-"+i),o=t.date(d,{"return":a.dateFormat}),c=!0,l=a.multipleSelect?t.isNumber(a.multipleSelect)?a.multipleSelect:2:1,a.selectable&&(n.selectableMap[o]||(c=!1)),"date"==i?c&&(n.selection.length>=l&&(s=n.selection.splice(0,n.selection.length-(l-1)),s.forEach(function(e){n.$.body.find('[data-calendar-item-date="'+t.date(e,{"return":a.dateFormat})+'"]').removeClass("selected-day")})),jQuery(r).addClass("selected-day"),n.selection.push(d),n.onClick&&n.onClick.call({self:this,date:d,target:this.target,dateElement:r})):"month"==i?"month"==a.selectMode?c&&(n.selection.length>=l&&(s=n.selection.splice(0,n.selection.length-(l-1)),s.forEach(function(e){n.$.body.find('[data-calendar-item-month="'+t.date(e,{"return":"yyyy-MM-dd"})+'"]').removeClass("selected-month")})),jQuery(r).addClass("selected-month"),n.selection.push(d),n.onClick&&n.onClick.call({self:this,date:d,target:this.target,dateElement:r})):n.changeMode("day",d):"year"==i&&("year"==a.selectMode?c&&(n.selection.length>=l&&(s=n.selection.splice(0,n.selection.length-(l-1)),s.forEach(function(e){n.$.body.find('[data-calendar-item-year="'+t.date(e,{"return":"yyyy-MM-dd"})+'"]').removeClass("selected-year")})),jQuery(r).addClass("selected-year"),n.selection.push(d),n.onClick&&n.onClick.call({self:this,date:d,target:this.target,dateElement:r})):n.changeMode("month",d))),i=null,r=null,d=null,s=null,o=null,c=null},p=function(e,n,l){n=t.findParentNode(e.target,function(e){return e.getAttribute("data-calendar-move")?!0:void 0}),n&&(l=n.getAttribute("data-calendar-move"),"day"==a.mode?("left"==l?a.displayDate=t.date(a.displayDate,{add:{m:-1}}):a.displayDate=t.date(a.displayDate,{add:{m:1}}),u.call(this,a.displayDate)):"month"==a.mode?("left"==l?a.displayDate=t.date(a.displayDate,{add:{y:-1}}):a.displayDate=t.date(a.displayDate,{add:{y:1}}),m.call(this,a.displayDate)):"year"==a.mode&&("left"==l?a.displayDate=t.date(a.displayDate,{add:{y:-10}}):a.displayDate=t.date(a.displayDate,{add:{y:10}}),f.call(this,a.displayDate))),n=null,l=null},g=function(){setTimeout(function(){if("day"===a.mode||"d"===a.mode)for(var e in this.markerMap)this.$.body.find('[data-calendar-item-date="'+e+'"]').addClass(this.markerMap[e].theme||a.defaultMarkerTheme)}.bind(this))},b=function(){setTimeout(function(){for(var e in this.selectionMap)this.$.body.find('[data-calendar-item-date="'+e+'"]').addClass("selected-day")}.bind(this))},v=function(){setTimeout(function(){if("day"===a.mode||"d"===a.mode)for(var e in this.periodMap)this.periodMap[e].label&&this.$.body.find('[data-calendar-item-date="'+e+'"]').find(".addon-footer").html(this.periodMap[e].label),this.$.body.find('[data-calendar-item-date="'+e+'"]').addClass(this.periodMap[e].theme)}.bind(this))},M=function(){if("day"===a.mode||"d"===a.mode)for(var e in this.periodMap)this.$.body.find('[data-calendar-item-date="'+e+'"]').find(".addon-footer").empty(),this.$.body.find('[data-calendar-item-date="'+e+'"]').removeClass(this.periodMap[e].theme)};this.init=function(){this.onStateChanged=a.onStateChanged,this.onClick=a.onClick,a.target||console.log(ax5.info.getError("ax5calendar","401","setConfig")),this.target=jQuery(a.target),a.displayDate=t.date(a.displayDate),this.target.html(d.call(this)),this.$={root:this.target.find('[data-calendar-els="root"]'),control:this.target.find('[data-calendar-els="control"]'),"control-display":this.target.find('[data-calendar-els="control-display"]'),body:this.target.find('[data-calendar-els="body"]')},a.control&&this.$.control.find("[data-calendar-move]").on(a.clickEventName,function(e){p.call(this,e||window.event)}.bind(this)),a.selection&&this.setSelection(a.selection,!1),a.selectable&&this.setSelectable(a.selectable,!1),a.marker&&this.setMarker(a.marker,!1),setTimeout(function(){"day"===a.mode||"d"===a.mode?u.call(this,a.displayDate):"month"===a.mode||"m"===a.mode?m.call(this,a.displayDate):("year"===a.mode||"y"===a.mode)&&f.call(this,a.displayDate)}.bind(this))},this.changeMode=function(e,t){return"undefined"!=typeof t&&(a.displayDate=t),e&&(a.mode=e),this.$.body.removeClass("fadein").addClass("fadeout"),setTimeout(function(){"day"==a.mode||"d"==a.mode?u.call(this,a.displayDate):"month"==a.mode||"m"==a.mode?m.call(this,a.displayDate):("year"==a.mode||"y"==a.mode)&&f.call(this,a.displayDate),this.$.body.removeClass("fadeout").addClass("fadein")}.bind(this),a.animateTime),this},this.setSelection=function(){n.selectionMap={};var e={arr:function(e,l,i){return l={},t.isArray(e)?(n.selection=e=e.splice(0,i),e.forEach(function(e){t.isDate(e)&&(e=t.date(e,{"return":a.dateFormat})),l[e]=!0}),l):l}};return function(n,i){var r={};if(l=a.multipleSelect?t.isNumber(a.multipleSelect)?a.multipleSelect:2:1,a.selection=n){if(!t.isArray(n))return this;r=e.arr(n,{},l)}return this.selectionMap=jQuery.extend({},r),i!==!1&&b.call(this),r=null,this}}(),this.getSelection=function(){return this.selection},this.setSelectable=function(){n.selectableMap={};var e={arr:function(e,n){return n={},t.isArray(e)?(e.forEach(function(e){t.isDate(e)&&(e=t.date(e,{"return":a.dateFormat})),n[e]=!0}),n):n},obj:function(e,a){if(a={},t.isArray(e))return a;if(e.range)return a;for(var n in e)a[n]=e[n];return a},range:function(e,n){return n={},t.isArray(e)?n:e.range?(e.range.forEach(function(e){if(t.isDateFormat(e.from)&&t.isDateFormat(e.to))for(var l=t.date(e.from);l<=t.date(e.to);l.setDate(l.getDate()+1))n[t.date(l,{"return":a.dateFormat})]=!0;else for(var i=e.from;i<=e.to;i++)n[i]=!0}),n):n}};return function(n,l){var i,r={};if(a.selectable=n)if(t.isArray(n))r=e.arr(n);else{for(i in e)if(n[i]){r=e[i](n);break}0===Object.keys(r).length&&(r=e.obj(n))}return this.selectableMap=r,l!==!1&&this.changeMode(),this}}(),this.setMarker=function(){n.markerMap={};var e={obj:function(e,a){if(a={},t.isArray(e))return a;if(e.range)return a;for(var n in e)a[n]=e[n];return e=null,a},range:function(e,n){return n={},t.isArray(e)?n:e.range?(e.range.forEach(function(e){if(t.isDateFormat(e.from)&&t.isDateFormat(e.to))for(var l=t.date(e.from);l<=t.date(e.to);l.setDate(l.getDate()+1))n[t.date(l,{"return":a.dateFormat})]={theme:e.theme,label:e.label};else for(var i=e.from;i<=e.to;i++)n[i]={theme:e.theme,label:e.label}}),e=null,n):n}};return function(t,n){var l,i={};if(a.marker=t){for(l in e)if(t[l]){i=e[l](t);break}0===Object.keys(i).length&&(i=e.obj(t))}return this.markerMap=i,n!==!1&&g.call(this),this}}(),this.setPeriod=function(){n.periodMap={};var e={range:function(e,n){return n={},t.isArray(e)?n:e.range?(e.range.forEach(function(e){if(t.isDateFormat(e.from)&&t.isDateFormat(e.to))for(var l=new Date(t.date(e.from));l<=t.date(e.to);l.setDate(l.getDate()+1))l.getTime()==t.date(e.from).getTime()?n[t.date(l,{"return":a.dateFormat})]={theme:e.theme||a.defaultPeriodTheme,label:e.fromLabel}:l.getTime()==t.date(e.to).getTime()?n[t.date(l,{"return":a.dateFormat})]={theme:e.theme||a.defaultPeriodTheme,label:e.toLabel}:n[t.date(l,{"return":a.dateFormat})]={theme:e.theme||a.defaultPeriodTheme}}),e=null,n):n}};return function(t,n){var l={};return n!==!1&&M.call(this),(a.period=t)&&(l=e.range(t)),this.periodMap=l,n!==!1&&v.call(this),this}}(),this.main=function(){e.calendar_instance=e.calendar_instance||[],e.calendar_instance.push(this),arguments&&t.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};return a}())}();