"use strict";!function(){var e=ax5.ui,t=ax5.ui.root,a=ax5.util,n="ax5calendar",l="0.8.6",i=function(){t&&t.call(this);var i,r=this,s=1;this.name=n,this.version=l,this.instanceId=ax5.getGuid(),this.target=null,this.selection=[],this.selectionMap={},this.selectableMap={},this.markerMap={},this.printedDay={start:"",end:""},this.config={clickEventName:"click",theme:"default",mode:"day",dateFormat:"yyyy-MM-dd",displayDate:new Date,animateTime:250,dimensions:{controlHeight:"40",controlButtonWidth:"40",colHeadHeight:"30",itemPadding:2},lang:{yearHeading:"Choose the year",monthHeading:"Choose the month",yearTmpl:"%s",months:["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],dayTmpl:"%s"},multipleSelect:!1,selectMode:"day",defaultMarkerTheme:"holiday",defaultPeriodTheme:"period"},i=this.config;var d=function(e,t){e&&e.onStateChanged?e.onStateChanged.call(t,t):this.onStateChanged&&this.onStateChanged.call(t,t),t=null},o=function(){return'\n                <div class="ax5-ui-calendar {{theme}}" data-calendar-els="root" onselectstart="return false;">\n                    {{#control}}\n                    <div class="calendar-control" data-calendar-els="control" style="{{controlCSS}}">\n                        <a class="date-move-left" data-calendar-move="left" style="{{controlButtonCSS}}">{{{left}}}</a>\n                        <div class="date-display" data-calendar-els="control-display" style="{{controlCSS}}"></div>\n                        <a class="date-move-right" data-calendar-move="right" style="{{controlButtonCSS}}">{{{right}}}</a>\n                    </div>\n                    {{/control}}\n                    <div class="calendar-body" data-calendar-els="body"></div>\n                </div>\n                '},c=function(){var e=jQuery.extend(!0,{},i,{controlCSS:{},controlButtonCSS:{}}),t=o();e.controlButtonCSS.height=e.controlCSS.height=a.cssNumber(i.dimensions.controlHeight),e.controlButtonCSS["line-height"]=e.controlCSS["line-height"]=a.cssNumber(i.dimensions.controlHeight),e.controlButtonCSS.width=a.cssNumber(i.dimensions.controlHeight),e.controlCSS=a.css(e.controlCSS),e.controlButtonCSS=a.css(e.controlButtonCSS);try{return ax5.mustache.render(t,e)}finally{e=null,t=null}},h=function(){return'\n                <table data-calendar-table="day" cellpadding="0" cellspacing="0" style="width:100%;">\n                    <thead>\n                        <tr>\n                        {{#weekNames}}\n                            <td class="calendar-col-{{col}}" style="height: {{colHeadHeight}}">\n                            {{label}}\n                            </td>\n                        {{/weekNames}}\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            {{#list}}    \n                            {{#isStartOfWeek}}\n                            {{^@first}}\n                        </tr>\n                        <tr>\n                            {{/@first}}\n                            {{/isStartOfWeek}}\n                            <td class="calendar-col-{{col}}" style="{{itemStyles}}">\n                                <a class="calendar-item-day {{addClass}}" data-calendar-item-date="{{thisDate}}">\n                                    <span class="addon addon-header"></span>\n                                    {{thisDataLabel}}\n                                    <span class="addon addon-footer"></span>\n                                </a>\n                            </td>\n                            {{/list}}\n                        </tr>\n                    </tbody>\n                </table>\n                '},u=function(){return'\n                <table data-calendar-table="month" cellpadding="0" cellspacing="0" style="width:100%;">\n                    <thead>\n                        <tr>\n                            <td class="calendar-col-0" colspan="3" style="height: {{colHeadHeight}}">\n                            {{colHeadLabel}}\n                            </td>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            {{#list}}    \n                            {{#isStartOfRow}}\n                            {{^@first}}\n                        </tr>\n                        <tr>\n                            {{/@first}}\n                            {{/isStartOfRow}}\n                            <td class="calendar-col-{{col}}" style="{{itemStyles}}">\n                                <a class="calendar-item-month {{addClass}}" data-calendar-item-month="{{thisMonth}}">\n                                    <span class="addon"></span>\n                                    {{thisMonthLabel}}\n                                    <span class="lunar"></span>\n                                </a>\n                            </td>\n                            {{/list}}\n                        </tr>\n                    </tbody>\n                </table>\n                '},m=function(){return'\n                <table data-calendar-table="year" cellpadding="0" cellspacing="0" style="width:100%;">\n                    <thead>\n                        <tr>\n                            <td class="calendar-col-0" colspan="4" style="height: {{colHeadHeight}}">\n                            {{colHeadLabel}}\n                            </td>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            {{#list}}    \n                            {{#isStartOfRow}}\n                            {{^@first}}\n                        </tr>\n                        <tr>\n                            {{/@first}}\n                            {{/isStartOfRow}}\n                            <td class="calendar-col-{{col}}" style="{{itemStyles}}">\n                                <a class="calendar-item-year {{addClass}}" data-calendar-item-year="{{thisYear}}">\n                                    <span class="addon"></span>\n                                    {{thisYearLabel}}\n                                    <span class="lunar"></span>\n                                </a>\n                            </td>\n                            {{/list}}\n                        </tr>\n                    </tbody>\n                </table>\n                '},f=function(){var e,t,n=a.date(i.displayDate),l="",r="";return i.control&&("day"==i.mode||"d"==i.mode?(l=i.control.yearTmpl?i.control.yearTmpl.replace("%s",n.getFullYear()):n.getFullYear(),r=i.control.monthTmpl?i.control.monthTmpl.replace("%s",i.lang.months[n.getMonth()]):i.lang.months[n.getMonth()],this.$["control-display"].html(function(){return i.control.yearFirst?'<span data-calendar-display="year">'+l+'</span><span data-calendar-display="month">'+r+"</span>":'<span data-calendar-display="month">'+r+'</span><span data-calendar-display="year">'+l+"</span>"}())):"month"==i.mode||"m"==i.mode?(l=i.control.yearTmpl?i.control.yearTmpl.replace("%s",n.getFullYear()):n.getFullYear(),this.$["control-display"].html('<span data-calendar-display="year">'+l+"</span>")):("year"==i.mode||"y"==i.mode)&&(e=i.control.yearTmpl?i.control.yearTmpl.replace("%s",n.getFullYear()-10):n.getFullYear()-10,t=i.control.yearTmpl?i.control.yearTmpl.replace("%s",Number(n.getFullYear())+9):Number(n.getFullYear())+9,this.$["control-display"].html(e+" ~ "+t)),this.$["control-display"].find("[data-calendar-display]").on(i.clickEventName,function(e){var t,n=a.findParentNode(e.target,function(e){return e.getAttribute("data-calendar-display")?!0:void 0});n&&(t=n.getAttribute("data-calendar-display"),this.changeMode(t)),n=null,t=null}.bind(this))),n=null,l=null,r=null,e=null,t=null,this},y=function(e){var t,n,l,s,o=a.date(e),c=new Date(o.getFullYear(),o.getMonth(),1,12),u=i.displayDate,m=function(){var e=c.getDay();0==e&&(e=7);try{return a.date(c,{add:{d:-e}})}finally{e=null}}(),y=o.getMonth(),p={},g=this.$.body.width(),v=Math.floor(g*(6/7)),M=h();for(i.dimensions.height&&(v=a.number(i.dimensions.height)-a.number(i.dimensions.colHeadHeight)),p.height=Math.floor(v/6)-2*a.number(i.dimensions.itemPadding)+"px",p["line-height"]=p.height,p.padding=a.cssNumber(i.dimensions.itemPadding),s={weekNames:[].concat(ax5.info.weekNames),list:[]},s.weekNames.forEach(function(e){e.colHeadHeight=a.cssNumber(i.dimensions.colHeadHeight)}),t=m,n=0;6>n;){for(l=0;7>l;){var D=""+a.date(t,{"return":i.dateFormat}),S={row:n,col:l,isStartOfWeek:0==l,thisDate:""+D,thisDataLabel:i.lang.dayTmpl.replace("%s",t.getDate()),itemStyles:a.css(p),addClass:function(){return i.selectable?r.selectableMap[D]?t.getMonth()==y?"live":"":"disable":t.getMonth()==y?D==a.date(u,{"return":"yyyyMMdd"})?"focus":"live":""}()+" "+function(){return r.markerMap[D]?r.markerMap[D].theme||i.defaultMarkerTheme:""}()+" "+function(){return r.selectionMap[D]?"selected-day":""}()};s.list.push(S),l++,t=a.date(t,{add:{d:1}}),D=null,S=null}n++}this.$.body.html(ax5.mustache.render(M,s)),this.$.body.find("[data-calendar-item-date]").on(i.clickEventName,function(e){e=e||window.event,b.call(r,e,"date"),a.stopEvent(e)}),this.printedDay={start:m,end:t},d.call(this,null,{self:this,action:"printDay",printedDay:this.printedDay}),f.call(this),o=null,c=null,u=null,m=null,t=null,y=null,p=null,n=null,l=null,g=null,v=null,s=null,M=null},p=function(e){var t,n,l,s,o,c=a.date(e),h=c.getMonth(),m={},y=this.$.body.width(),p=Math.floor(y*(6/7)),g=u();for(i.dimensions.height&&(p=a.number(i.dimensions.height)-a.number(i.dimensions.colHeadHeight)),m.height=Math.floor(p/4)-2*a.number(i.dimensions.itemPadding)+"px",m["line-height"]=m.height,m.padding=a.cssNumber(i.dimensions.itemPadding),o={colHeadHeight:a.cssNumber(i.dimensions.colHeadHeight),colHeadLabel:i.lang.monthHeading,list:[]},s=0,l=0,t=0;4>t;){for(n=0;3>n;){var v={row:t,col:n,isStartOfRow:0==n,thisMonth:c.getFullYear()+"-"+a.setDigit(l+1,2)+"-"+a.setDigit(c.getDate(),2),thisMonthLabel:i.lang.months[l],itemStyles:a.css(m),addClass:function(){return i.selectable?r.selectableMap[l]?"live":"disable":"live"}()+" "+function(){return l==h?"focus":""}()+" "+function(){return r.markerMap[l]?r.markerMap[l].theme||i.defaultMarkerTheme:""}()};o.list.push(v),l++,n++,v=null}t++}this.$.body.html(ax5.mustache.render(g,o)),this.$.body.find("[data-calendar-item-month]").on(i.clickEventName,function(e){e=e||window.event,b.call(r,e,"month"),a.stopEvent(e)}),this.printedDay={start:c.getFullYear()+"-"+a.setDigit(s+1,2),end:c.getFullYear()+"-"+a.setDigit(l,2)},d.call(this,null,{self:this,action:"printMonth",printedDay:this.printedDay}),f.call(this),c=null,h=null,m=null,t=null,n=null,l=null,s=null,y=null,p=null,o=null,g=null},g=function(e){var t,n,l,s,o,c=a.date(e),h=c.getFullYear(),u={},y=this.$.body.width(),p=Math.floor(y*(6/7)),g=m();for(i.dimensions.height&&(p=a.number(i.dimensions.height)-a.number(i.dimensions.colHeadHeight)),u.height=Math.floor(p/5)-2*a.number(i.dimensions.itemPadding)+"px",u["line-height"]=u.height,u.padding=a.cssNumber(i.dimensions.itemPadding),o={colHeadHeight:a.cssNumber(i.dimensions.colHeadHeight),colHeadLabel:i.lang.yearHeading,list:[]},s=h-10,l=h-10,t=0;5>t;){for(n=0;4>n;){var v={row:t,col:n,isStartOfRow:0==n,thisYear:l+"-"+a.setDigit(c.getMonth()+1,2)+"-"+a.setDigit(c.getDate(),2),thisYearLabel:i.lang.yearTmpl.replace("%s",l),itemStyles:a.css(u),addClass:function(){return i.selectable?r.selectableMap[l]?"live":"disable":"live"}()+" "+function(){return l==h?"focus":""}()+" "+function(){return r.selectableMap[l]?r.selectableMap[l].theme||i.defaultMarkerTheme:""}()};o.list.push(v),l++,n++,v=null}t++}this.$.body.html(ax5.mustache.render(g,o)),this.$.body.find("[data-calendar-item-year]").on(i.clickEventName,function(e){e=e||window.event,b.call(this,e,"year"),a.stopEvent(e)}),this.printedDay={start:s,end:l-1},d.call(this,null,{self:this,action:"printYear",printedDay:this.printedDay}),f.call(this),c=null,h=null,u=null,t=null,n=null,l=null,s=null,y=null,p=null,o=null,g=null},b=function(e,t,n,l){var d,o,c;t=t||"date",n=a.findParentNode(e.target,function(e){return e.getAttribute("data-calendar-item-"+t)?!0:void 0}),n&&(l=n.getAttribute("data-calendar-item-"+t),o=a.date(l,{"return":i.dateFormat}),c=!0,s=i.multipleSelect?a.isNumber(i.multipleSelect)?i.multipleSelect:2:1,i.selectable&&(r.selectableMap[o]||(c=!1)),"date"==t?c&&(r.selection.length>=s&&(d=r.selection.splice(0,r.selection.length-(s-1)),d.forEach(function(e){r.$.body.find('[data-calendar-item-date="'+a.date(e,{"return":i.dateFormat})+'"]').removeClass("selected-day")})),jQuery(n).addClass("selected-day"),r.selection.push(l),r.onClick&&r.onClick.call({self:this,date:l,target:this.target,dateElement:n})):"month"==t?"month"==i.selectMode?c&&(r.selection.length>=s&&(d=r.selection.splice(0,r.selection.length-(s-1)),d.forEach(function(e){r.$.body.find('[data-calendar-item-month="'+a.date(e,{"return":"yyyy-MM-dd"})+'"]').removeClass("selected-month")})),jQuery(n).addClass("selected-month"),r.selection.push(l),r.onClick&&r.onClick.call({self:this,date:l,target:this.target,dateElement:n})):r.changeMode("day",l):"year"==t&&("year"==i.selectMode?c&&(r.selection.length>=s&&(d=r.selection.splice(0,r.selection.length-(s-1)),d.forEach(function(e){r.$.body.find('[data-calendar-item-year="'+a.date(e,{"return":"yyyy-MM-dd"})+'"]').removeClass("selected-year")})),jQuery(n).addClass("selected-year"),r.selection.push(l),r.onClick&&r.onClick.call({self:this,date:l,target:this.target,dateElement:n})):r.changeMode("month",l))),t=null,n=null,l=null,d=null,o=null,c=null},v=function(e,t,n){t=a.findParentNode(e.target,function(e){return e.getAttribute("data-calendar-move")?!0:void 0}),t&&(n=t.getAttribute("data-calendar-move"),"day"==i.mode?("left"==n?i.displayDate=a.date(i.displayDate,{add:{m:-1}}):i.displayDate=a.date(i.displayDate,{add:{m:1}}),y.call(this,i.displayDate)):"month"==i.mode?("left"==n?i.displayDate=a.date(i.displayDate,{add:{y:-1}}):i.displayDate=a.date(i.displayDate,{add:{y:1}}),p.call(this,i.displayDate)):"year"==i.mode&&("left"==n?i.displayDate=a.date(i.displayDate,{add:{y:-10}}):i.displayDate=a.date(i.displayDate,{add:{y:10}}),g.call(this,i.displayDate))),t=null,n=null},M=function(){setTimeout(function(){if("day"===i.mode||"d"===i.mode)for(var e in this.markerMap)this.$.body.find('[data-calendar-item-date="'+e+'"]').addClass(this.markerMap[e].theme||i.defaultMarkerTheme)}.bind(this))},D=function(){setTimeout(function(){for(var e in this.selectionMap)this.$.body.find('[data-calendar-item-date="'+e+'"]').addClass("selected-day")}.bind(this))},S=function(){setTimeout(function(){if("day"===i.mode||"d"===i.mode)for(var e in this.periodMap)this.periodMap[e].label&&this.$.body.find('[data-calendar-item-date="'+e+'"]').find(".addon-footer").html(this.periodMap[e].label),this.$.body.find('[data-calendar-item-date="'+e+'"]').addClass(this.periodMap[e].theme)}.bind(this))},C=function(){if("day"===i.mode||"d"===i.mode)for(var e in this.periodMap)this.$.body.find('[data-calendar-item-date="'+e+'"]').find(".addon-footer").empty(),this.$.body.find('[data-calendar-item-date="'+e+'"]').removeClass(this.periodMap[e].theme)};this.init=function(){this.onStateChanged=i.onStateChanged,this.onClick=i.onClick,i.target||console.log(ax5.info.getError("ax5calendar","401","setConfig")),this.target=jQuery(i.target),i.displayDate=a.date(i.displayDate),this.target.html(c.call(this)),this.$={root:this.target.find('[data-calendar-els="root"]'),control:this.target.find('[data-calendar-els="control"]'),"control-display":this.target.find('[data-calendar-els="control-display"]'),body:this.target.find('[data-calendar-els="body"]')},i.control&&this.$.control.find("[data-calendar-move]").on(i.clickEventName,function(e){v.call(this,e||window.event)}.bind(this)),i.selection&&this.setSelection(i.selection,!1),i.selectable&&this.setSelectable(i.selectable,!1),i.marker&&this.setMarker(i.marker,!1),setTimeout(function(){"day"===i.mode||"d"===i.mode?y.call(this,i.displayDate):"month"===i.mode||"m"===i.mode?p.call(this,i.displayDate):("year"===i.mode||"y"===i.mode)&&g.call(this,i.displayDate)}.bind(this))},this.changeMode=function(e,t){return"undefined"!=typeof t&&(i.displayDate=t),e&&(i.mode=e),this.$.body.removeClass("fadein").addClass("fadeout"),setTimeout(function(){"day"==i.mode||"d"==i.mode?y.call(this,i.displayDate):"month"==i.mode||"m"==i.mode?p.call(this,i.displayDate):("year"==i.mode||"y"==i.mode)&&g.call(this,i.displayDate),this.$.body.removeClass("fadeout").addClass("fadein")}.bind(this),i.animateTime),this},this.setSelection=function(){r.selectionMap={};var e={arr:function(e,t,n){return t={},a.isArray(e)?(r.selection=e=e.splice(0,n),e.forEach(function(e){a.isDate(e)&&(e=a.date(e,{"return":i.dateFormat})),t[e]=!0}),t):t}};return function(t,n){var l={};if(s=i.multipleSelect?a.isNumber(i.multipleSelect)?i.multipleSelect:2:1,i.selection=t){if(!a.isArray(t))return this;l=e.arr(t,{},s)}return this.selectionMap=jQuery.extend({},l),n!==!1&&D.call(this),l=null,this}}(),this.getSelection=function(){return this.selection},this.setSelectable=function(){r.selectableMap={};var e={arr:function(e,t){return t={},a.isArray(e)?(e.forEach(function(e){a.isDate(e)&&(e=a.date(e,{"return":i.dateFormat})),t[e]=!0}),t):t},obj:function(e,t){if(t={},a.isArray(e))return t;if(e.range)return t;for(var n in e)t[n]=e[n];return t},range:function(e,t){return t={},a.isArray(e)?t:e.range?(e.range.forEach(function(e){if(a.isDateFormat(e.from)&&a.isDateFormat(e.to))for(var n=a.date(e.from);n<=a.date(e.to);n.setDate(n.getDate()+1))t[a.date(n,{"return":i.dateFormat})]=!0;else for(var l=e.from;l<=e.to;l++)t[l]=!0}),t):t}};return function(t,n){var l,r={};if(i.selectable=t)if(a.isArray(t))r=e.arr(t);else{for(l in e)if(t[l]){r=e[l](t);break}0===Object.keys(r).length&&(r=e.obj(t))}return this.selectableMap=r,n!==!1&&this.changeMode(),this}}(),this.setMarker=function(){r.markerMap={};var e={obj:function(e,t){if(t={},a.isArray(e))return t;if(e.range)return t;for(var n in e)t[n]=e[n];return e=null,t},range:function(e,t){return t={},a.isArray(e)?t:e.range?(e.range.forEach(function(e){if(a.isDateFormat(e.from)&&a.isDateFormat(e.to))for(var n=a.date(e.from);n<=a.date(e.to);n.setDate(n.getDate()+1))t[a.date(n,{"return":i.dateFormat})]={theme:e.theme,label:e.label};else for(var l=e.from;l<=e.to;l++)t[l]={theme:e.theme,label:e.label}}),e=null,t):t}};return function(t,a){var n,l={};if(i.marker=t){for(n in e)if(t[n]){l=e[n](t);break}0===Object.keys(l).length&&(l=e.obj(t))}return this.markerMap=l,a!==!1&&M.call(this),this}}(),this.setPeriod=function(){r.periodMap={};var e={range:function(e,t){return t={},a.isArray(e)?t:e.range?(e.range.forEach(function(e){if(a.isDateFormat(e.from)&&a.isDateFormat(e.to))for(var n=new Date(a.date(e.from));n<=a.date(e.to);n.setDate(n.getDate()+1))n.getTime()==a.date(e.from).getTime()?t[a.date(n,{"return":i.dateFormat})]={theme:e.theme||i.defaultPeriodTheme,label:e.fromLabel}:n.getTime()==a.date(e.to).getTime()?t[a.date(n,{"return":i.dateFormat})]={theme:e.theme||i.defaultPeriodTheme,label:e.toLabel}:t[a.date(n,{"return":i.dateFormat})]={theme:e.theme||i.defaultPeriodTheme}}),e=null,t):t}};return function(t,a){var n={};return a!==!1&&C.call(this),(i.period=t)&&(n=e.range(t)),this.periodMap=n,a!==!1&&S.call(this),this}}(),this.main=function(){e.calendar_instance=e.calendar_instance||[],e.calendar_instance.push(this),arguments&&a.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};e.calendar=function(){return a.isFunction(t)&&(i.prototype=new t),i}()}();