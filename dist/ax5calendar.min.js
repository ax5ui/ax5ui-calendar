"use strict";!function(e,t){var a=ax5.util,i=function(){t&&t.call(this);var e,i=this,n=1;this.target=null,this.selection=[],this.selectionMap={},this.selectableMap={},this.markerMap={},this.printedDay={start:"",end:""},this.config={clickEventName:"click",theme:"default",mode:"day",dateFormat:"yyyy-mm-dd",displayDate:new Date,animateTime:250,dimensions:{controlHeight:"40",controlButtonWidth:"40",colHeadHeight:"30",itemPadding:2},lang:{yearHeading:"Choose the year",monthHeading:"Choose the month",yearTmpl:"%s",months:["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],dayTmpl:"%s"},multipleSelect:!1,selectMode:"day",defaultMarkerTheme:"holiday"},e=this.config,this.init=function(){this.onStateChanged=e.onStateChanged,this.onClick=e.onClick,e.target||console.log(ax5.info.getError("ax5calendar","401","setConfig")),this.target=jQuery(e.target),e.displayDate=a.date(e.displayDate),this.target.html(this.getFrame()),this.$={root:this.target.find('[data-calendar-els="root"]'),control:this.target.find('[data-calendar-els="control"]'),"control-display":this.target.find('[data-calendar-els="control-display"]'),body:this.target.find('[data-calendar-els="body"]')},e.control&&this.$.control.find("[data-calendar-move]").on(e.clickEventName,function(e){this.move(e||window.event)}.bind(this)),e.selection&&this.setSelection(e.selection,!1),e.selectable&&this.setSelectable(e.selectable,!1),e.marker&&this.setMarker(e.marker,!1),setTimeout(function(){"day"===e.mode||"d"===e.mode?this.printDay(e.displayDate):"month"===e.mode||"m"===e.mode?this.printMonth(e.displayDate):("year"===e.mode||"y"===e.mode)&&this.printYear(e.displayDate)}.bind(this))},this.getFrame=function(){var t=[];if(t.push('<div class="ax5-ui-calendar '+e.theme+'" data-calendar-els="root" onselectstart="return false;">'),e.control){var i={},n={};n.height=i.height=a.cssNumber(e.dimensions.controlHeight),n["line-height"]=i["line-height"]=a.cssNumber(e.dimensions.controlHeight),n.width=a.cssNumber(e.dimensions.controlHeight),t.push('<div class="calendar-control" data-calendar-els="control" style="'+a.css(i)+'">'),t.push('<a class="date-move-left" data-calendar-move="left" style="'+a.css(n)+'">'+e.control.left+"</a>"),t.push('<div class="date-display" data-calendar-els="control-display" style="'+a.css(i)+'"></div>'),t.push('<a class="date-move-right" data-calendar-move="right" style="'+a.css(n)+'">'+e.control.right+"</a>"),t.push("</div>")}return t.push('<div class="calendar-body" data-calendar-els="body"></div>'),t.push("</div>"),t.join("")},this.setDisplay=function(){if(e.control){var t=a.date(e.displayDate),i="",n="";if("day"==e.mode||"d"==e.mode)i=e.control.yearTmpl?e.control.yearTmpl.replace("%s",t.getFullYear()):t.getFullYear(),n=e.control.monthTmpl?e.control.monthTmpl.replace("%s",e.lang.months[t.getMonth()]):e.lang.months[t.getMonth()],this.$["control-display"].html(function(){return e.control.yearFirst?'<span data-calendar-display="year">'+i+'</span><span data-calendar-display="month">'+n+"</span>":'<span data-calendar-display="month">'+n+'</span><span data-calendar-display="year">'+i+"</span>"}());else if("month"==e.mode||"m"==e.mode)i=e.control.yearTmpl?e.control.yearTmpl.replace("%s",t.getFullYear()):t.getFullYear(),this.$["control-display"].html('<span data-calendar-display="year">'+i+"</span>");else if("year"==e.mode||"y"==e.mode){var s=e.control.yearTmpl?e.control.yearTmpl.replace("%s",t.getFullYear()-10):t.getFullYear()-10,r=e.control.yearTmpl?e.control.yearTmpl.replace("%s",Number(t.getFullYear())+9):Number(t.getFullYear())+9;this.$["control-display"].html(s+" ~ "+r)}this.$["control-display"].find("[data-calendar-display]").on(e.clickEventName,function(e){var t=a.findParentNode(e.target,function(e){return e.getAttribute("data-calendar-display")?!0:void 0});if(t){var i=t.getAttribute("data-calendar-display");this.changeMode(i)}}.bind(this))}return this},this.printDay=function(t){var n,s,r,l,d=a.date(t),o=[],c=new Date(d.getFullYear(),d.getMonth(),1,12),h=e.displayDate,u=function(){var e=c.getDay();return 0==e&&(e=7),a.date(c,{add:{d:-e}})}(),m=d.getMonth(),p={},y=this.$.body.width(),f=Math.floor(y*(6/7));for(e.dimensions.height&&(f=a.number(e.dimensions.height)-a.number(e.dimensions.colHeadHeight)),p.height=Math.floor(f/6)-2*a.number(e.dimensions.itemPadding)+"px",p["line-height"]=p.height,p.padding=a.cssNumber(e.dimensions.itemPadding),o.push('<table data-calendar-table="day" cellpadding="0" cellspacing="0" style="width:100%;">'),o.push("<thead>"),o.push("<tr>"),l=0;7>l;)o.push('<td class="calendar-col-'+l+'" style="height: '+a.cssNumber(e.dimensions.colHeadHeight)+'">'),o.push(ax5.info.weekNames[l].label),o.push("</td>"),l++;for(o.push("</tr>"),o.push("</thead>"),o.push("<tbody>"),n=u,r=0;6>r;){for(o.push("<tr>"),l=0;7>l;)s=""+a.date(n,{"return":e.dateFormat}),o.push('<td class="calendar-col-'+l+'" style="'+a.css(p)+'">'),o.push('<a class="calendar-item-day '+function(){return e.selectable?i.selectableMap[s]?n.getMonth()==m?"live":"":"disable":n.getMonth()==m?s==a.date(h,{"return":"yyyymmdd"})?"focus":"live":""}()+" "+function(){return i.markerMap[s]?i.markerMap[s].theme||e.defaultMarkerTheme:""}()+" "+function(){return i.selectionMap[s]?"selected-day":""}()+'" data-calendar-item-date="'+s+'"><span class="addon"></span>'+e.lang.dayTmpl.replace("%s",n.getDate())+'<span class="lunar"></span></a>'),o.push("</td>"),l++,n=a.date(n,{add:{d:1}});o.push("</tr>"),r++}if(o.push("</tbody>"),o.push("</table>"),this.$.body.html(o.join("")),this.$.body.find("[data-calendar-item-date]").on(e.clickEventName,function(e){e=e||window.event,i.onclick(e,"date");try{e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0}catch(e){}return!1}),this.printedDay={start:u,end:n},this.onStateChanged){var g={self:this,action:"printDay",printedDay:this.printedDay};this.onStateChanged.call(g,g)}this.setDisplay()},this.printMonth=function(t){var n,s,r,l,d=a.date(t),o=d.getMonth(),c=[],h={},u=this.$.body.width(),m=Math.floor(u*(6/7));for(e.dimensions.height&&(m=a.number(e.dimensions.height)-a.number(e.dimensions.colHeadHeight)),h.height=Math.floor(m/4)-2*a.number(e.dimensions.itemPadding)+"px",h["line-height"]=h.height,h.padding=a.cssNumber(e.dimensions.itemPadding),c.push('<table data-calendar-table="month" cellpadding="0" cellspacing="0" style="width:100%;">'),c.push("<thead>"),c.push("<tr>"),c.push('<td class="calendar-col-0" colspan="3" style="height: '+a.cssNumber(e.dimensions.colHeadHeight)+'">'+e.lang.monthHeading+"</td>"),c.push("</tr>"),c.push("</thead>"),c.push("<tbody>"),l=0,r=0,n=0;4>n;){for(c.push("<tr>"),s=0;3>s;)c.push('<td class="calendar-col-'+n+'" style="'+a.css(h)+'">'),c.push('<a class="calendar-item-month '+function(){return e.selectable?i.selectableMap[r]?"live":"disable":"live"}()+" "+function(){return r==o?"focus":""}()+" "+function(){return i.markerMap[r]?i.markerMap[r].theme||e.defaultMarkerTheme:""}()+'" data-calendar-item-month="'+function(){return d.getFullYear()+"-"+a.setDigit(r+1,2)+"-"+a.setDigit(d.getDate(),2)}()+'">'+e.lang.months[r]+"</a>"),c.push("</td>"),r++,s++;c.push("</tr>"),n++}if(c.push("</tbody>"),c.push("</table>"),this.$.body.html(c.join("")),this.$.body.find("[data-calendar-item-month]").on(e.clickEventName,function(e){e=e||window.event,i.onclick(e,"month");try{e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0}catch(e){}return!1}),this.printedDay={start:d.getFullYear()+"-"+a.setDigit(l+1,2),end:d.getFullYear()+"-"+a.setDigit(r,2)},this.onStateChanged){var p={self:this,action:"printMonth",printedDay:this.printedDay};this.onStateChanged.call(p,p)}return this.setDisplay(),this},this.printYear=function(t){var n,s,r,l,d=a.date(t),o=d.getFullYear(),c=[],h={},u=this.$.body.width(),m=Math.floor(u*(6/7));for(e.dimensions.height&&(m=a.number(e.dimensions.height)-a.number(e.dimensions.colHeadHeight)),h.height=Math.floor(m/5)-2*a.number(e.dimensions.itemPadding)+"px",h["line-height"]=h.height,h.padding=a.cssNumber(e.dimensions.itemPadding),c.push('<table data-calendar-table="year" cellpadding="0" cellspacing="0" style="width:100%;">'),c.push("<thead>"),c.push("<tr>"),c.push('<td class="calendar-col-0" colspan="4" style="height: '+a.cssNumber(e.dimensions.colHeadHeight)+'">'+e.lang.yearHeading+"</td>"),c.push("</tr>"),c.push("</thead>"),c.push("<tbody>"),l=o-10,r=o-10,n=0;5>n;){for(c.push("<tr>"),s=0;4>s;)c.push('<td class="calendar-col-'+n+'" style="'+a.css(h)+'">'),c.push('<a class="calendar-item-year '+function(){return e.selectable?i.selectableMap[r]?"live":"disable":"live"}()+" "+function(){return r==o?"focus":""}()+" "+function(){return i.selectableMap[r]?i.selectableMap[r].theme||e.defaultMarkerTheme:""}()+'" data-calendar-item-year="'+function(){return r+"-"+a.setDigit(d.getMonth()+1,2)+"-"+a.setDigit(d.getDate(),2)}()+'">'+e.lang.yearTmpl.replace("%s",r)+"</a>"),c.push("</td>"),r++,s++;c.push("</tr>"),n++}if(c.push("</tbody>"),c.push("</table>"),this.$.body.html(c.join("")),this.$.body.find("[data-calendar-item-year]").on(e.clickEventName,function(e){e=e||window.event,i.onclick(e,"year");try{e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0}catch(e){}return!1}),this.printedDay={start:l,end:r-1},this.onStateChanged){var p={self:this,action:"printYear",printedDay:this.printedDay};this.onStateChanged.call(p,p)}return this.setDisplay(),this},this.onclick=function(t,s,r,l){if(s=s||"date",r=a.findParentNode(t.target,function(e){return e.getAttribute("data-calendar-item-"+s)?!0:void 0})){l=r.getAttribute("data-calendar-item-"+s);var d=a.date(l,{"return":e.dateFormat}),o=!0;if(n=e.multipleSelect?a.isNumber(e.multipleSelect)?e.multipleSelect:2:1,e.selectable&&(i.selectableMap[d]||(o=!1)),"date"==s){if(o){if(i.selection.length>=n){var c=i.selection.splice(0,i.selection.length-(n-1));c.forEach(function(t){i.$.body.find('[data-calendar-item-date="'+a.date(t,{"return":e.dateFormat})+'"]').removeClass("selected-day")})}jQuery(r).addClass("selected-day"),i.selection.push(l),i.onClick&&i.onClick.call({date:l,target:this.target,dateElement:r})}}else if("month"==s)if("month"==e.selectMode){if(o){if(i.selection.length>=n){var c=i.selection.splice(0,i.selection.length-(n-1));c.forEach(function(e){i.$.body.find('[data-calendar-item-month="'+a.date(e,{"return":"yyyy-mm-dd"})+'"]').removeClass("selected-month")})}jQuery(r).addClass("selected-month"),i.selection.push(l),i.onClick&&i.onClick.call({date:l,target:this.target,dateElement:r})}}else i.changeMode("day",l);else if("year"==s)if("year"==e.selectMode){if(o){if(i.selection.length>=n){var c=i.selection.splice(0,i.selection.length-(n-1));c.forEach(function(e){i.$.body.find('[data-calendar-item-year="'+a.date(e,{"return":"yyyy-mm-dd"})+'"]').removeClass("selected-year")})}jQuery(r).addClass("selected-year"),i.selection.push(l),i.onClick&&i.onClick.call({date:l,target:this.target,dateElement:r})}}else i.changeMode("month",l)}},this.move=function(t,i,n){return i=a.findParentNode(t.target,function(e){return e.getAttribute("data-calendar-move")?!0:void 0}),i&&(n=i.getAttribute("data-calendar-move"),"day"==e.mode?("left"==n?e.displayDate=a.date(e.displayDate,{add:{m:-1}}):e.displayDate=a.date(e.displayDate,{add:{m:1}}),this.printDay(e.displayDate)):"month"==e.mode?("left"==n?e.displayDate=a.date(e.displayDate,{add:{y:-1}}):e.displayDate=a.date(e.displayDate,{add:{y:1}}),this.printMonth(e.displayDate)):"year"==e.mode&&("left"==n?e.displayDate=a.date(e.displayDate,{add:{y:-10}}):e.displayDate=a.date(e.displayDate,{add:{y:10}}),this.printYear(e.displayDate))),this},this.changeMode=function(t,a){return"undefined"!=typeof a&&(e.displayDate=a),t&&(e.mode=t),this.$.body.removeClass("fadein").addClass("fadeout"),setTimeout(function(){"day"==e.mode||"d"==e.mode?this.printDay(e.displayDate):"month"==e.mode||"m"==e.mode?this.printMonth(e.displayDate):("year"==e.mode||"y"==e.mode)&&this.printYear(e.displayDate),this.$.body.removeClass("fadeout").addClass("fadein")}.bind(this),e.animateTime),this},this.setDisplayDate=function(t){return e.displayDate=a.date(t),this.$.body.removeClass("fadein").addClass("fadeout"),setTimeout(function(){"day"==e.mode||"d"==e.mode?this.printDay(e.displayDate):"month"==e.mode||"m"==e.mode?this.printMonth(e.displayDate):("year"==e.mode||"y"==e.mode)&&this.printYear(e.displayDate),this.$.body.removeClass("fadeout").addClass("fadein")}.bind(this),e.animateTime),this},this.setSelection=function(){i.selectionMap={};var t={arr:function(t,n,s){return n={},a.isArray(t)?(i.selection=t=t.splice(0,s),t.forEach(function(t){a.isDate(t)&&(t=a.date(t,{"return":e.dateFormat})),n[t]=!0}),n):n}};return function(i,s){var r={};if(n=e.multipleSelect?a.isNumber(e.multipleSelect)?e.multipleSelect:2:1,e.selection=i){if(!a.isArray(i))return this;r=t.arr(i,{},n)}this.selectionMap=r,s!==!1&&this.applySelectionMap()}}(),this.getSelection=function(){return this.selection},this.setSelectable=function(){i.selectableMap={};var t={arr:function(t,i){return i={},a.isArray(t)?(t.forEach(function(t){a.isDate(t)&&(t=a.date(t,{"return":e.dateFormat})),i[t]=!0}),i):i},obj:function(e,t){if(t={},a.isArray(e))return t;if(e.range)return t;for(var i in e)t[i]=e[i];return t},range:function(t,i){return i={},a.isArray(t)?i:t.range?(t.range.forEach(function(t){if(a.isDateFormat(t.from)&&a.isDateFormat(t.to))for(var n=a.date(t.from);n<=a.date(t.to);n.setDate(n.getDate()+1))i[a.date(n,{"return":e.dateFormat})]=!0;else for(var s=t.from;s<=t.to;s++)i[s]=!0}),i):i}};return function(i,n){var s,r={};if(e.selectable=i)if(a.isArray(i))r=t.arr(i);else{for(s in t)if(i[s]){r=t[s](i);break}0===Object.keys(r).length&&(r=t.obj(i))}this.selectableMap=r,n!==!1&&this.changeMode()}}(),this.setMarker=function(){i.markerMap={};var t={obj:function(e,t){if(t={},a.isArray(e))return t;if(e.range)return t;for(var i in e)t[i]=e[i];return t},range:function(t,i){return i={},a.isArray(t)?i:t.range?(t.range.forEach(function(t){if(a.isDateFormat(t.from)&&a.isDateFormat(t.to))for(var n=a.date(t.from);n<=a.date(t.to);n.setDate(n.getDate()+1))i[a.date(n,{"return":e.dateFormat})]={theme:t.theme,label:t.label};else for(var s=t.from;s<=t.to;s++)i[s]={theme:t.theme,label:t.label}}),i):i}};return function(a,i){var n,s={};if(e.marker=a){for(n in t)if(a[n]){s=t[n](a);break}0===Object.keys(s).length&&(s=t.obj(a))}return this.markerMap=s,i!==!1&&this.applyMarkerMap(),this}}(),this.applyMarkerMap=function(){setTimeout(function(){if("day"===e.mode||"d"===e.mode)for(var t in this.markerMap)this.$.body.find('[data-calendar-item-date="'+t+'"]').addClass(this.markerMap[t].theme||e.defaultMarkerTheme)}.bind(this))},this.applySelectionMap=function(){setTimeout(function(){for(var e in this.selectionMap)this.$.body.find('[data-calendar-item-date="'+e+'"]').addClass("selected-day")}.bind(this))},this.main=function(){arguments&&a.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};e.calendar=function(){return a.isFunction(t)&&(i.prototype=new t),i}()}(ax5.ui,ax5.ui.root);