"use strict";!function(e,t){var a=ax5.util,n=function(){t&&t.call(this);var e,n=this,i=1;this.target=null,this.selection=[],this.selectionMap={},this.selectableMap={},this.markerMap={},this.printedDay={start:"",end:""},this.config={clickEventName:"click",theme:"default",mode:"day",dateFormat:"yyyy-mm-dd",displayDate:new Date,animateTime:250,dimensions:{controlHeight:"40",controlButtonWidth:"40",colHeadHeight:"30",itemPadding:2},lang:{yearHeading:"Choose the year",monthHeading:"Choose the month",yearTmpl:"%s",months:["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],dayTmpl:"%s"},multipleSelect:!1,selectMode:"day",defaultMarkerTheme:"holiday"},e=this.config;var l=function(e,t){return e&&e.onStateChanged?e.onStateChanged.call(t,t):this.onStateChanged&&this.onStateChanged.call(t,t),!0},r=function(){return'\n                <div class="ax5-ui-calendar {{theme}}" data-calendar-els="root" onselectstart="return false;">\n                    {{#control}}\n                    <div class="calendar-control" data-calendar-els="control" style="{{controlCSS}}">\n                        <a class="date-move-left" data-calendar-move="left" style="{{controlButtonCSS}}">{{{left}}}</a>\n                        <div class="date-display" data-calendar-els="control-display" style="{{controlCSS}}"></div>\n                        <a class="date-move-right" data-calendar-move="right" style="{{controlButtonCSS}}">{{{right}}}</a>\n                    </div>\n                    {{/control}}\n                    <div class="calendar-body" data-calendar-els="body"></div>\n                </div>\n                '},s=function(){var t=jQuery.extend(!0,{},e,{controlCSS:{},controlButtonCSS:{}});return t.controlButtonCSS.height=t.controlCSS.height=a.cssNumber(e.dimensions.controlHeight),t.controlButtonCSS["line-height"]=t.controlCSS["line-height"]=a.cssNumber(e.dimensions.controlHeight),t.controlButtonCSS.width=a.cssNumber(e.dimensions.controlHeight),t.controlCSS=a.css(t.controlCSS),t.controlButtonCSS=a.css(t.controlButtonCSS),ax5.mustache.render(r(),t)},d=function(){return'\n                <table data-calendar-table="day" cellpadding="0" cellspacing="0" style="width:100%;">\n                    <thead>\n                        <tr>\n                        {{#weekNames}}\n                            <td class="calendar-col-{{@i}}" style="height: {{colHeadHeight}}">\n                            {{label}}\n                            </td>\n                        {{/weekNames}}\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            {{#list}}    \n                            {{#isStartOfWeek}}\n                            {{^@first}}\n                        </tr>\n                        <tr>\n                            {{/@first}}\n                            {{/isStartOfWeek}}\n                            <td class="calendar-col-{{@i}}" style="{{itemStyles}}">\n                                <a class="calendar-item-day {{addClass}}" data-calendar-item-date="{{thisDate}}">\n                                    <span class="addon"></span>\n                                    {{thisDataLabel}}\n                                    <span class="lunar"></span>\n                                </a>\n                            </td>\n                            {{/list}}\n                        </tr>\n                    </tbody>\n                </table>\n                '},o=function(){return'\n                <table data-calendar-table="month" cellpadding="0" cellspacing="0" style="width:100%;">\n                    <thead>\n                        <tr>\n                            <td class="calendar-col-0" colspan="3" style="height: {{colHeadHeight}}">\n                            {{colHeadLabel}}\n                            </td>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            {{#list}}    \n                            {{#isStartOfRow}}\n                            {{^@first}}\n                        </tr>\n                        <tr>\n                            {{/@first}}\n                            {{/isStartOfRow}}\n                            <td class="calendar-col-{{@i}}" style="{{itemStyles}}">\n                                <a class="calendar-item-month {{addClass}}" data-calendar-item-month="{{thisMonth}}">\n                                    <span class="addon"></span>\n                                    {{thisMonthLabel}}\n                                    <span class="lunar"></span>\n                                </a>\n                            </td>\n                            {{/list}}\n                        </tr>\n                    </tbody>\n                </table>\n                '},c=function(){return'\n                <table data-calendar-table="year" cellpadding="0" cellspacing="0" style="width:100%;">\n                    <thead>\n                        <tr>\n                            <td class="calendar-col-0" colspan="4" style="height: {{colHeadHeight}}">\n                            {{colHeadLabel}}\n                            </td>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            {{#list}}    \n                            {{#isStartOfRow}}\n                            {{^@first}}\n                        </tr>\n                        <tr>\n                            {{/@first}}\n                            {{/isStartOfRow}}\n                            <td class="calendar-col-{{@i}}" style="{{itemStyles}}">\n                                <a class="calendar-item-year {{addClass}}" data-calendar-item-year="{{thisYear}}">\n                                    <span class="addon"></span>\n                                    {{thisYearLabel}}\n                                    <span class="lunar"></span>\n                                </a>\n                            </td>\n                            {{/list}}\n                        </tr>\n                    </tbody>\n                </table>\n                '},h=function(){if(e.control){var t=a.date(e.displayDate),n="",i="";if("day"==e.mode||"d"==e.mode)n=e.control.yearTmpl?e.control.yearTmpl.replace("%s",t.getFullYear()):t.getFullYear(),i=e.control.monthTmpl?e.control.monthTmpl.replace("%s",e.lang.months[t.getMonth()]):e.lang.months[t.getMonth()],this.$["control-display"].html(function(){return e.control.yearFirst?'<span data-calendar-display="year">'+n+'</span><span data-calendar-display="month">'+i+"</span>":'<span data-calendar-display="month">'+i+'</span><span data-calendar-display="year">'+n+"</span>"}());else if("month"==e.mode||"m"==e.mode)n=e.control.yearTmpl?e.control.yearTmpl.replace("%s",t.getFullYear()):t.getFullYear(),this.$["control-display"].html('<span data-calendar-display="year">'+n+"</span>");else if("year"==e.mode||"y"==e.mode){var l=e.control.yearTmpl?e.control.yearTmpl.replace("%s",t.getFullYear()-10):t.getFullYear()-10,r=e.control.yearTmpl?e.control.yearTmpl.replace("%s",Number(t.getFullYear())+9):Number(t.getFullYear())+9;this.$["control-display"].html(l+" ~ "+r)}this.$["control-display"].find("[data-calendar-display]").on(e.clickEventName,function(e){var t=a.findParentNode(e.target,function(e){return e.getAttribute("data-calendar-display")?!0:void 0});if(t){var n=t.getAttribute("data-calendar-display");this.changeMode(n)}}.bind(this))}return this},m=function(t){var i,r,s,o=a.date(t),c=new Date(o.getFullYear(),o.getMonth(),1,12),m=e.displayDate,u=function(){var e=c.getDay();return 0==e&&(e=7),a.date(c,{add:{d:-e}})}(),f=o.getMonth(),g={},p=this.$.body.width(),b=Math.floor(p*(6/7));e.dimensions.height&&(b=a.number(e.dimensions.height)-a.number(e.dimensions.colHeadHeight)),g.height=Math.floor(b/6)-2*a.number(e.dimensions.itemPadding)+"px",g["line-height"]=g.height,g.padding=a.cssNumber(e.dimensions.itemPadding);var v={weekNames:[].concat(ax5.info.weekNames),list:[]};for(v.weekNames.forEach(function(t){t.colHeadHeight=a.cssNumber(e.dimensions.colHeadHeight)}),i=u,r=0;6>r;){for(s=0;7>s;){var D=""+a.date(i,{"return":e.dateFormat}),S={isStartOfWeek:0==s,thisDate:""+D,thisDataLabel:e.lang.dayTmpl.replace("%s",i.getDate()),itemStyles:a.css(g),addClass:function(){return e.selectable?n.selectableMap[D]?i.getMonth()==f?"live":"":"disable":i.getMonth()==f?D==a.date(m,{"return":"yyyymmdd"})?"focus":"live":""}()+" "+function(){return n.markerMap[D]?n.markerMap[D].theme||e.defaultMarkerTheme:""}()+" "+function(){return n.selectionMap[D]?"selected-day":""}()};v.list.push(S),s++,i=a.date(i,{add:{d:1}})}r++}this.$.body.html(ax5.mustache.render(d(),v)),this.$.body.find("[data-calendar-item-date]").on(e.clickEventName,function(e){e=e||window.event,y.call(n,e,"date"),a.stopEvent(e)}),this.printedDay={start:u,end:i},l.call(this,null,{self:this,action:"printDay",printedDay:this.printedDay}),h.call(this)},u=function(t){var i,r,s,d,c=a.date(t),m=c.getMonth(),u={},f=this.$.body.width(),g=Math.floor(f*(6/7));e.dimensions.height&&(g=a.number(e.dimensions.height)-a.number(e.dimensions.colHeadHeight)),u.height=Math.floor(g/4)-2*a.number(e.dimensions.itemPadding)+"px",u["line-height"]=u.height,u.padding=a.cssNumber(e.dimensions.itemPadding);var p={colHeadHeight:a.cssNumber(e.dimensions.colHeadHeight),colHeadLabel:e.lang.monthHeading,list:[]};for(d=0,s=0,i=0;4>i;){for(r=0;3>r;){var b={row:i,col:r,isStartOfRow:0==r,thisMonth:c.getFullYear()+"-"+a.setDigit(s+1,2)+"-"+a.setDigit(c.getDate(),2),thisMonthLabel:e.lang.months[s],itemStyles:a.css(u),addClass:function(){return e.selectable?n.selectableMap[s]?"live":"disable":"live"}()+" "+function(){return s==m?"focus":""}()+" "+function(){return n.markerMap[s]?n.markerMap[s].theme||e.defaultMarkerTheme:""}()};p.list.push(b),s++,r++}i++}this.$.body.html(ax5.mustache.render(o(),p)),this.$.body.find("[data-calendar-item-month]").on(e.clickEventName,function(e){e=e||window.event,y.call(n,e,"month"),a.stopEvent(e)}),this.printedDay={start:c.getFullYear()+"-"+a.setDigit(d+1,2),end:c.getFullYear()+"-"+a.setDigit(s,2)},l.call(this,null,{self:this,action:"printMonth",printedDay:this.printedDay}),h.call(this)},f=function(t){var i,r,s,d,o=a.date(t),m=o.getFullYear(),u={},f=this.$.body.width(),g=Math.floor(f*(6/7));e.dimensions.height&&(g=a.number(e.dimensions.height)-a.number(e.dimensions.colHeadHeight)),u.height=Math.floor(g/5)-2*a.number(e.dimensions.itemPadding)+"px",u["line-height"]=u.height,u.padding=a.cssNumber(e.dimensions.itemPadding);var p={colHeadHeight:a.cssNumber(e.dimensions.colHeadHeight),colHeadLabel:e.lang.yearHeading,list:[]};for(d=m-10,s=m-10,i=0;5>i;){for(r=0;4>r;){var b={row:i,col:r,isStartOfRow:0==r,thisYear:s+"-"+a.setDigit(o.getMonth()+1,2)+"-"+a.setDigit(o.getDate(),2),thisYearLabel:e.lang.yearTmpl.replace("%s",s),itemStyles:a.css(u),addClass:function(){return e.selectable?n.selectableMap[s]?"live":"disable":"live"}()+" "+function(){return s==m?"focus":""}()+" "+function(){return n.selectableMap[s]?n.selectableMap[s].theme||e.defaultMarkerTheme:""}()};p.list.push(b),s++,r++}i++}this.$.body.html(ax5.mustache.render(c(),p)),this.$.body.find("[data-calendar-item-year]").on(e.clickEventName,function(e){e=e||window.event,y.call(this,e,"year"),a.stopEvent(e)}),this.printedDay={start:d,end:s-1},l.call(this,null,{self:this,action:"printYear",printedDay:this.printedDay}),h.call(this)},y=function(t,l,r,s){if(l=l||"date",r=a.findParentNode(t.target,function(e){return e.getAttribute("data-calendar-item-"+l)?!0:void 0})){s=r.getAttribute("data-calendar-item-"+l);var d=a.date(s,{"return":e.dateFormat}),o=!0;if(i=e.multipleSelect?a.isNumber(e.multipleSelect)?e.multipleSelect:2:1,e.selectable&&(n.selectableMap[d]||(o=!1)),"date"==l){if(o){if(n.selection.length>=i){var c=n.selection.splice(0,n.selection.length-(i-1));c.forEach(function(t){n.$.body.find('[data-calendar-item-date="'+a.date(t,{"return":e.dateFormat})+'"]').removeClass("selected-day")})}jQuery(r).addClass("selected-day"),n.selection.push(s),n.onClick&&n.onClick.call({date:s,target:this.target,dateElement:r})}}else if("month"==l)if("month"==e.selectMode){if(o){if(n.selection.length>=i){var c=n.selection.splice(0,n.selection.length-(i-1));c.forEach(function(e){n.$.body.find('[data-calendar-item-month="'+a.date(e,{"return":"yyyy-mm-dd"})+'"]').removeClass("selected-month")})}jQuery(r).addClass("selected-month"),n.selection.push(s),n.onClick&&n.onClick.call({date:s,target:this.target,dateElement:r})}}else n.changeMode("day",s);else if("year"==l)if("year"==e.selectMode){if(o){if(n.selection.length>=i){var c=n.selection.splice(0,n.selection.length-(i-1));c.forEach(function(e){n.$.body.find('[data-calendar-item-year="'+a.date(e,{"return":"yyyy-mm-dd"})+'"]').removeClass("selected-year")})}jQuery(r).addClass("selected-year"),n.selection.push(s),n.onClick&&n.onClick.call({date:s,target:this.target,dateElement:r})}}else n.changeMode("month",s)}},g=function(t,n,i){n=a.findParentNode(t.target,function(e){return e.getAttribute("data-calendar-move")?!0:void 0}),n&&(i=n.getAttribute("data-calendar-move"),"day"==e.mode?("left"==i?e.displayDate=a.date(e.displayDate,{add:{m:-1}}):e.displayDate=a.date(e.displayDate,{add:{m:1}}),m.call(this,e.displayDate)):"month"==e.mode?("left"==i?e.displayDate=a.date(e.displayDate,{add:{y:-1}}):e.displayDate=a.date(e.displayDate,{add:{y:1}}),u.call(this,e.displayDate)):"year"==e.mode&&("left"==i?e.displayDate=a.date(e.displayDate,{add:{y:-10}}):e.displayDate=a.date(e.displayDate,{add:{y:10}}),f.call(this,e.displayDate)))},p=function(){setTimeout(function(){if("day"===e.mode||"d"===e.mode)for(var t in this.markerMap)this.$.body.find('[data-calendar-item-date="'+t+'"]').addClass(this.markerMap[t].theme||e.defaultMarkerTheme)}.bind(this))},b=function(){setTimeout(function(){for(var e in this.selectionMap)this.$.body.find('[data-calendar-item-date="'+e+'"]').addClass("selected-day")}.bind(this))};this.init=function(){this.onStateChanged=e.onStateChanged,this.onClick=e.onClick,e.target||console.log(ax5.info.getError("ax5calendar","401","setConfig")),this.target=jQuery(e.target),e.displayDate=a.date(e.displayDate),this.target.html(s.call(this)),this.$={root:this.target.find('[data-calendar-els="root"]'),control:this.target.find('[data-calendar-els="control"]'),"control-display":this.target.find('[data-calendar-els="control-display"]'),body:this.target.find('[data-calendar-els="body"]')},e.control&&this.$.control.find("[data-calendar-move]").on(e.clickEventName,function(e){g.call(this,e||window.event)}.bind(this)),e.selection&&this.setSelection(e.selection,!1),e.selectable&&this.setSelectable(e.selectable,!1),e.marker&&this.setMarker(e.marker,!1),setTimeout(function(){"day"===e.mode||"d"===e.mode?m.call(this,e.displayDate):"month"===e.mode||"m"===e.mode?u.call(this,e.displayDate):("year"===e.mode||"y"===e.mode)&&f.call(this,e.displayDate)}.bind(this))},this.changeMode=function(t,a){return"undefined"!=typeof a&&(e.displayDate=a),t&&(e.mode=t),this.$.body.removeClass("fadein").addClass("fadeout"),setTimeout(function(){"day"==e.mode||"d"==e.mode?m.call(this,e.displayDate):"month"==e.mode||"m"==e.mode?u.call(this,e.displayDate):("year"==e.mode||"y"==e.mode)&&f.call(this,e.displayDate),this.$.body.removeClass("fadeout").addClass("fadein")}.bind(this),e.animateTime),this},this.setSelection=function(){n.selectionMap={};var t={arr:function(t,i,l){return i={},a.isArray(t)?(n.selection=t=t.splice(0,l),t.forEach(function(t){a.isDate(t)&&(t=a.date(t,{"return":e.dateFormat})),i[t]=!0}),i):i}};return function(n,l){var r={};if(i=e.multipleSelect?a.isNumber(e.multipleSelect)?e.multipleSelect:2:1,e.selection=n){if(!a.isArray(n))return this;r=t.arr(n,{},i)}this.selectionMap=r,l!==!1&&b.call(this)}}(),this.getSelection=function(){return this.selection},this.setSelectable=function(){n.selectableMap={};var t={arr:function(t,n){return n={},a.isArray(t)?(t.forEach(function(t){a.isDate(t)&&(t=a.date(t,{"return":e.dateFormat})),n[t]=!0}),n):n},obj:function(e,t){if(t={},a.isArray(e))return t;if(e.range)return t;for(var n in e)t[n]=e[n];return t},range:function(t,n){return n={},a.isArray(t)?n:t.range?(t.range.forEach(function(t){if(a.isDateFormat(t.from)&&a.isDateFormat(t.to))for(var i=a.date(t.from);i<=a.date(t.to);i.setDate(i.getDate()+1))n[a.date(i,{"return":e.dateFormat})]=!0;else for(var l=t.from;l<=t.to;l++)n[l]=!0}),n):n}};return function(n,i){var l,r={};if(e.selectable=n)if(a.isArray(n))r=t.arr(n);else{for(l in t)if(n[l]){r=t[l](n);break}0===Object.keys(r).length&&(r=t.obj(n))}this.selectableMap=r,i!==!1&&this.changeMode()}}(),this.setMarker=function(){n.markerMap={};var t={obj:function(e,t){if(t={},a.isArray(e))return t;if(e.range)return t;for(var n in e)t[n]=e[n];return t},range:function(t,n){return n={},a.isArray(t)?n:t.range?(t.range.forEach(function(t){if(a.isDateFormat(t.from)&&a.isDateFormat(t.to))for(var i=a.date(t.from);i<=a.date(t.to);i.setDate(i.getDate()+1))n[a.date(i,{"return":e.dateFormat})]={theme:t.theme,label:t.label};else for(var l=t.from;l<=t.to;l++)n[l]={theme:t.theme,label:t.label}}),n):n}};return function(a,n){var i,l={};if(e.marker=a){for(i in t)if(a[i]){l=t[i](a);break}0===Object.keys(l).length&&(l=t.obj(a))}return this.markerMap=l,n!==!1&&p.call(this),this}}(),this.main=function(){arguments&&a.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};e.calendar=function(){return a.isFunction(t)&&(n.prototype=new t),n}()}(ax5.ui,ax5.ui.root);