"use strict";!function(t,e){var a=ax5.util,n=function(){e&&e.call(this);var n,l=this,i=1;this.target=null,this.selection=[],this.selectionMap={},this.selectableMap={},this.markerMap={},this.printedDay={start:"",end:""},this.config={clickEventName:"click",theme:"default",mode:"day",dateFormat:"yyyy-MM-dd",displayDate:new Date,animateTime:250,dimensions:{controlHeight:"40",controlButtonWidth:"40",colHeadHeight:"30",itemPadding:2},lang:{yearHeading:"Choose the year",monthHeading:"Choose the month",yearTmpl:"%s",months:["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],dayTmpl:"%s"},multipleSelect:!1,selectMode:"day",defaultMarkerTheme:"holiday"},n=this.config;var s=function(t,e){t&&t.onStateChanged?t.onStateChanged.call(e,e):this.onStateChanged&&this.onStateChanged.call(e,e),e=null},r=function(){return'\n                <div class="ax5-ui-calendar {{theme}}" data-calendar-els="root" onselectstart="return false;">\n                    {{#control}}\n                    <div class="calendar-control" data-calendar-els="control" style="{{controlCSS}}">\n                        <a class="date-move-left" data-calendar-move="left" style="{{controlButtonCSS}}">{{{left}}}</a>\n                        <div class="date-display" data-calendar-els="control-display" style="{{controlCSS}}"></div>\n                        <a class="date-move-right" data-calendar-move="right" style="{{controlButtonCSS}}">{{{right}}}</a>\n                    </div>\n                    {{/control}}\n                    <div class="calendar-body" data-calendar-els="body"></div>\n                </div>\n                '},d=function(){var t=jQuery.extend(!0,{},n,{controlCSS:{},controlButtonCSS:{}}),e=r();t.controlButtonCSS.height=t.controlCSS.height=a.cssNumber(n.dimensions.controlHeight),t.controlButtonCSS["line-height"]=t.controlCSS["line-height"]=a.cssNumber(n.dimensions.controlHeight),t.controlButtonCSS.width=a.cssNumber(n.dimensions.controlHeight),t.controlCSS=a.css(t.controlCSS),t.controlButtonCSS=a.css(t.controlButtonCSS);try{return ax5.mustache.render(e,t)}finally{t=null,e=null}},o=function(){return'\n                <table data-calendar-table="day" cellpadding="0" cellspacing="0" style="width:100%;">\n                    <thead>\n                        <tr>\n                        {{#weekNames}}\n                            <td class="calendar-col-{{@i}}" style="height: {{colHeadHeight}}">\n                            {{label}}\n                            </td>\n                        {{/weekNames}}\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            {{#list}}    \n                            {{#isStartOfWeek}}\n                            {{^@first}}\n                        </tr>\n                        <tr>\n                            {{/@first}}\n                            {{/isStartOfWeek}}\n                            <td class="calendar-col-{{@i}}" style="{{itemStyles}}">\n                                <a class="calendar-item-day {{addClass}}" data-calendar-item-date="{{thisDate}}">\n                                    <span class="addon"></span>\n                                    {{thisDataLabel}}\n                                    <span class="lunar"></span>\n                                </a>\n                            </td>\n                            {{/list}}\n                        </tr>\n                    </tbody>\n                </table>\n                '},c=function(){return'\n                <table data-calendar-table="month" cellpadding="0" cellspacing="0" style="width:100%;">\n                    <thead>\n                        <tr>\n                            <td class="calendar-col-0" colspan="3" style="height: {{colHeadHeight}}">\n                            {{colHeadLabel}}\n                            </td>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            {{#list}}    \n                            {{#isStartOfRow}}\n                            {{^@first}}\n                        </tr>\n                        <tr>\n                            {{/@first}}\n                            {{/isStartOfRow}}\n                            <td class="calendar-col-{{@i}}" style="{{itemStyles}}">\n                                <a class="calendar-item-month {{addClass}}" data-calendar-item-month="{{thisMonth}}">\n                                    <span class="addon"></span>\n                                    {{thisMonthLabel}}\n                                    <span class="lunar"></span>\n                                </a>\n                            </td>\n                            {{/list}}\n                        </tr>\n                    </tbody>\n                </table>\n                '},h=function(){return'\n                <table data-calendar-table="year" cellpadding="0" cellspacing="0" style="width:100%;">\n                    <thead>\n                        <tr>\n                            <td class="calendar-col-0" colspan="4" style="height: {{colHeadHeight}}">\n                            {{colHeadLabel}}\n                            </td>\n                        </tr>\n                    </thead>\n                    <tbody>\n                        <tr>\n                            {{#list}}    \n                            {{#isStartOfRow}}\n                            {{^@first}}\n                        </tr>\n                        <tr>\n                            {{/@first}}\n                            {{/isStartOfRow}}\n                            <td class="calendar-col-{{@i}}" style="{{itemStyles}}">\n                                <a class="calendar-item-year {{addClass}}" data-calendar-item-year="{{thisYear}}">\n                                    <span class="addon"></span>\n                                    {{thisYearLabel}}\n                                    <span class="lunar"></span>\n                                </a>\n                            </td>\n                            {{/list}}\n                        </tr>\n                    </tbody>\n                </table>\n                '},u=function(){var t,e,l=a.date(n.displayDate),i="",s="";return n.control&&("day"==n.mode||"d"==n.mode?(i=n.control.yearTmpl?n.control.yearTmpl.replace("%s",l.getFullYear()):l.getFullYear(),s=n.control.monthTmpl?n.control.monthTmpl.replace("%s",n.lang.months[l.getMonth()]):n.lang.months[l.getMonth()],this.$["control-display"].html(function(){return n.control.yearFirst?'<span data-calendar-display="year">'+i+'</span><span data-calendar-display="month">'+s+"</span>":'<span data-calendar-display="month">'+s+'</span><span data-calendar-display="year">'+i+"</span>"}())):"month"==n.mode||"m"==n.mode?(i=n.control.yearTmpl?n.control.yearTmpl.replace("%s",l.getFullYear()):l.getFullYear(),this.$["control-display"].html('<span data-calendar-display="year">'+i+"</span>")):("year"==n.mode||"y"==n.mode)&&(t=n.control.yearTmpl?n.control.yearTmpl.replace("%s",l.getFullYear()-10):l.getFullYear()-10,e=n.control.yearTmpl?n.control.yearTmpl.replace("%s",Number(l.getFullYear())+9):Number(l.getFullYear())+9,this.$["control-display"].html(t+" ~ "+e)),this.$["control-display"].find("[data-calendar-display]").on(n.clickEventName,function(t){var e,n=a.findParentNode(t.target,function(t){return t.getAttribute("data-calendar-display")?!0:void 0});n&&(e=n.getAttribute("data-calendar-display"),this.changeMode(e)),n=null,e=null}.bind(this))),l=null,i=null,s=null,t=null,e=null,this},m=function(t){var e,i,r,d,c=a.date(t),h=new Date(c.getFullYear(),c.getMonth(),1,12),m=n.displayDate,y=function(){var t=h.getDay();0==t&&(t=7);try{return a.date(h,{add:{d:-t}})}finally{t=null}}(),f=c.getMonth(),p={},b=this.$.body.width(),v=Math.floor(b*(6/7)),M=o();for(n.dimensions.height&&(v=a.number(n.dimensions.height)-a.number(n.dimensions.colHeadHeight)),p.height=Math.floor(v/6)-2*a.number(n.dimensions.itemPadding)+"px",p["line-height"]=p.height,p.padding=a.cssNumber(n.dimensions.itemPadding),d={weekNames:[].concat(ax5.info.weekNames),list:[]},d.weekNames.forEach(function(t){t.colHeadHeight=a.cssNumber(n.dimensions.colHeadHeight)}),e=y,i=0;6>i;){for(r=0;7>r;){var D=""+a.date(e,{"return":n.dateFormat}),S={isStartOfWeek:0==r,thisDate:""+D,thisDataLabel:n.lang.dayTmpl.replace("%s",e.getDate()),itemStyles:a.css(p),addClass:function(){return n.selectable?l.selectableMap[D]?e.getMonth()==f?"live":"":"disable":e.getMonth()==f?D==a.date(m,{"return":"yyyyMMdd"})?"focus":"live":""}()+" "+function(){return l.markerMap[D]?l.markerMap[D].theme||n.defaultMarkerTheme:""}()+" "+function(){return l.selectionMap[D]?"selected-day":""}()};d.list.push(S),r++,e=a.date(e,{add:{d:1}}),D=null,S=null}i++}this.$.body.html(ax5.mustache.render(M,d)),this.$.body.find("[data-calendar-item-date]").on(n.clickEventName,function(t){t=t||window.event,g.call(l,t,"date"),a.stopEvent(t)}),this.printedDay={start:y,end:e},s.call(this,null,{self:this,action:"printDay",printedDay:this.printedDay}),u.call(this),c=null,h=null,m=null,y=null,e=null,f=null,p=null,i=null,r=null,b=null,v=null,d=null,M=null},y=function(t){var e,i,r,d,o,h=a.date(t),m=h.getMonth(),y={},f=this.$.body.width(),p=Math.floor(f*(6/7)),b=c();for(n.dimensions.height&&(p=a.number(n.dimensions.height)-a.number(n.dimensions.colHeadHeight)),y.height=Math.floor(p/4)-2*a.number(n.dimensions.itemPadding)+"px",y["line-height"]=y.height,y.padding=a.cssNumber(n.dimensions.itemPadding),o={colHeadHeight:a.cssNumber(n.dimensions.colHeadHeight),colHeadLabel:n.lang.monthHeading,list:[]},d=0,r=0,e=0;4>e;){for(i=0;3>i;){var v={row:e,col:i,isStartOfRow:0==i,thisMonth:h.getFullYear()+"-"+a.setDigit(r+1,2)+"-"+a.setDigit(h.getDate(),2),thisMonthLabel:n.lang.months[r],itemStyles:a.css(y),addClass:function(){return n.selectable?l.selectableMap[r]?"live":"disable":"live"}()+" "+function(){return r==m?"focus":""}()+" "+function(){return l.markerMap[r]?l.markerMap[r].theme||n.defaultMarkerTheme:""}()};o.list.push(v),r++,i++,v=null}e++}this.$.body.html(ax5.mustache.render(b,o)),this.$.body.find("[data-calendar-item-month]").on(n.clickEventName,function(t){t=t||window.event,g.call(l,t,"month"),a.stopEvent(t)}),this.printedDay={start:h.getFullYear()+"-"+a.setDigit(d+1,2),end:h.getFullYear()+"-"+a.setDigit(r,2)},s.call(this,null,{self:this,action:"printMonth",printedDay:this.printedDay}),u.call(this),h=null,m=null,y=null,e=null,i=null,r=null,d=null,f=null,p=null,o=null,b=null},f=function(t){var e,i,r,d,o,c=a.date(t),m=c.getFullYear(),y={},f=this.$.body.width(),p=Math.floor(f*(6/7)),b=h();for(n.dimensions.height&&(p=a.number(n.dimensions.height)-a.number(n.dimensions.colHeadHeight)),y.height=Math.floor(p/5)-2*a.number(n.dimensions.itemPadding)+"px",y["line-height"]=y.height,y.padding=a.cssNumber(n.dimensions.itemPadding),o={colHeadHeight:a.cssNumber(n.dimensions.colHeadHeight),colHeadLabel:n.lang.yearHeading,list:[]},d=m-10,r=m-10,e=0;5>e;){for(i=0;4>i;){var v={row:e,col:i,isStartOfRow:0==i,thisYear:r+"-"+a.setDigit(c.getMonth()+1,2)+"-"+a.setDigit(c.getDate(),2),thisYearLabel:n.lang.yearTmpl.replace("%s",r),itemStyles:a.css(y),addClass:function(){return n.selectable?l.selectableMap[r]?"live":"disable":"live"}()+" "+function(){return r==m?"focus":""}()+" "+function(){return l.selectableMap[r]?l.selectableMap[r].theme||n.defaultMarkerTheme:""}()};o.list.push(v),r++,i++,v=null}e++}this.$.body.html(ax5.mustache.render(b,o)),this.$.body.find("[data-calendar-item-year]").on(n.clickEventName,function(t){t=t||window.event,g.call(this,t,"year"),a.stopEvent(t)}),this.printedDay={start:d,end:r-1},s.call(this,null,{self:this,action:"printYear",printedDay:this.printedDay}),u.call(this),c=null,m=null,y=null,e=null,i=null,r=null,d=null,f=null,p=null,o=null,b=null},g=function(t,e,s,r){var d,o,c;e=e||"date",s=a.findParentNode(t.target,function(t){return t.getAttribute("data-calendar-item-"+e)?!0:void 0}),s&&(r=s.getAttribute("data-calendar-item-"+e),o=a.date(r,{"return":n.dateFormat}),c=!0,i=n.multipleSelect?a.isNumber(n.multipleSelect)?n.multipleSelect:2:1,n.selectable&&(l.selectableMap[o]||(c=!1)),"date"==e?c&&(l.selection.length>=i&&(d=l.selection.splice(0,l.selection.length-(i-1)),d.forEach(function(t){l.$.body.find('[data-calendar-item-date="'+a.date(t,{"return":n.dateFormat})+'"]').removeClass("selected-day")})),jQuery(s).addClass("selected-day"),l.selection.push(r),l.onClick&&l.onClick.call({self:this,date:r,target:this.target,dateElement:s})):"month"==e?"month"==n.selectMode?c&&(l.selection.length>=i&&(d=l.selection.splice(0,l.selection.length-(i-1)),d.forEach(function(t){l.$.body.find('[data-calendar-item-month="'+a.date(t,{"return":"yyyy-MM-dd"})+'"]').removeClass("selected-month")})),jQuery(s).addClass("selected-month"),l.selection.push(r),l.onClick&&l.onClick.call({self:this,date:r,target:this.target,dateElement:s})):l.changeMode("day",r):"year"==e&&("year"==n.selectMode?c&&(l.selection.length>=i&&(d=l.selection.splice(0,l.selection.length-(i-1)),d.forEach(function(t){l.$.body.find('[data-calendar-item-year="'+a.date(t,{"return":"yyyy-MM-dd"})+'"]').removeClass("selected-year")})),jQuery(s).addClass("selected-year"),l.selection.push(r),l.onClick&&l.onClick.call({self:this,date:r,target:this.target,dateElement:s})):l.changeMode("month",r))),e=null,s=null,r=null,d=null,o=null,c=null},p=function(t,e,l){e=a.findParentNode(t.target,function(t){return t.getAttribute("data-calendar-move")?!0:void 0}),e&&(l=e.getAttribute("data-calendar-move"),"day"==n.mode?("left"==l?n.displayDate=a.date(n.displayDate,{add:{m:-1}}):n.displayDate=a.date(n.displayDate,{add:{m:1}}),m.call(this,n.displayDate)):"month"==n.mode?("left"==l?n.displayDate=a.date(n.displayDate,{add:{y:-1}}):n.displayDate=a.date(n.displayDate,{add:{y:1}}),y.call(this,n.displayDate)):"year"==n.mode&&("left"==l?n.displayDate=a.date(n.displayDate,{add:{y:-10}}):n.displayDate=a.date(n.displayDate,{add:{y:10}}),f.call(this,n.displayDate))),e=null,l=null},b=function(){setTimeout(function(){if("day"===n.mode||"d"===n.mode)for(var t in this.markerMap)this.$.body.find('[data-calendar-item-date="'+t+'"]').addClass(this.markerMap[t].theme||n.defaultMarkerTheme)}.bind(this))},v=function(){setTimeout(function(){for(var t in this.selectionMap)this.$.body.find('[data-calendar-item-date="'+t+'"]').addClass("selected-day")}.bind(this))};this.init=function(){this.onStateChanged=n.onStateChanged,this.onClick=n.onClick,n.target||console.log(ax5.info.getError("ax5calendar","401","setConfig")),this.target=jQuery(n.target),n.displayDate=a.date(n.displayDate),this.target.html(d.call(this)),this.$={root:this.target.find('[data-calendar-els="root"]'),control:this.target.find('[data-calendar-els="control"]'),"control-display":this.target.find('[data-calendar-els="control-display"]'),body:this.target.find('[data-calendar-els="body"]')},n.control&&this.$.control.find("[data-calendar-move]").on(n.clickEventName,function(t){p.call(this,t||window.event)}.bind(this)),n.selection&&this.setSelection(n.selection,!1),n.selectable&&this.setSelectable(n.selectable,!1),n.marker&&this.setMarker(n.marker,!1),setTimeout(function(){"day"===n.mode||"d"===n.mode?m.call(this,n.displayDate):"month"===n.mode||"m"===n.mode?y.call(this,n.displayDate):("year"===n.mode||"y"===n.mode)&&f.call(this,n.displayDate)}.bind(this))},this.changeMode=function(t,e){return"undefined"!=typeof e&&(n.displayDate=e),t&&(n.mode=t),this.$.body.removeClass("fadein").addClass("fadeout"),setTimeout(function(){"day"==n.mode||"d"==n.mode?m.call(this,n.displayDate):"month"==n.mode||"m"==n.mode?y.call(this,n.displayDate):("year"==n.mode||"y"==n.mode)&&f.call(this,n.displayDate),this.$.body.removeClass("fadeout").addClass("fadein")}.bind(this),n.animateTime),this},this.setSelection=function(){l.selectionMap={};var t={arr:function(t,e,i){return e={},a.isArray(t)?(l.selection=t=t.splice(0,i),t.forEach(function(t){a.isDate(t)&&(t=a.date(t,{"return":n.dateFormat})),e[t]=!0}),e):e}};return function(e,l){var s={};if(i=n.multipleSelect?a.isNumber(n.multipleSelect)?n.multipleSelect:2:1,n.selection=e){if(!a.isArray(e))return this;s=t.arr(e,{},i)}return this.selectionMap=jQuery.extend({},s),l!==!1&&v.call(this),s=null,this}}(),this.getSelection=function(){return this.selection},this.setSelectable=function(){l.selectableMap={};var t={arr:function(t,e){return e={},a.isArray(t)?(t.forEach(function(t){a.isDate(t)&&(t=a.date(t,{"return":n.dateFormat})),e[t]=!0}),e):e},obj:function(t,e){if(e={},a.isArray(t))return e;if(t.range)return e;for(var n in t)e[n]=t[n];return e},range:function(t,e){return e={},a.isArray(t)?e:t.range?(t.range.forEach(function(t){if(a.isDateFormat(t.from)&&a.isDateFormat(t.to))for(var l=a.date(t.from);l<=a.date(t.to);l.setDate(l.getDate()+1))e[a.date(l,{"return":n.dateFormat})]=!0;else for(var i=t.from;i<=t.to;i++)e[i]=!0}),e):e}};return function(e,l){var i,s={};if(n.selectable=e)if(a.isArray(e))s=t.arr(e);else{for(i in t)if(e[i]){s=t[i](e);break}0===Object.keys(s).length&&(s=t.obj(e))}return this.selectableMap=s,l!==!1&&this.changeMode(),this}}(),this.setMarker=function(){l.markerMap={};var t={obj:function(t,e){if(e={},a.isArray(t))return e;if(t.range)return e;for(var n in t)e[n]=t[n];return t=null,e},range:function(t,e){return e={},a.isArray(t)?e:t.range?(t.range.forEach(function(t){if(a.isDateFormat(t.from)&&a.isDateFormat(t.to))for(var l=a.date(t.from);l<=a.date(t.to);l.setDate(l.getDate()+1))e[a.date(l,{"return":n.dateFormat})]={theme:t.theme,label:t.label};else for(var i=t.from;i<=t.to;i++)e[i]={theme:t.theme,label:t.label}}),t=null,e):e}};return function(e,a){var l,i={};if(n.marker=e){for(l in t)if(e[l]){i=t[l](e);break}0===Object.keys(i).length&&(i=t.obj(e))}return this.markerMap=i,a!==!1&&b.call(this),this}}(),this.main=function(){t.calendar_instance=t.calendar_instance||[],t.calendar_instance.push(this),arguments&&a.isObject(arguments[0])&&this.setConfig(arguments[0])}.apply(this,arguments)};t.calendar=function(){return a.isFunction(e)&&(n.prototype=new e),n}()}(ax5.ui,ax5.ui.root);